<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
    xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="http://www.thymeleaf.org">

<head th:replace="common/head.html :: head">
    <link rel="stylesheet" href="/path/to/style.css">
</head>

<body>

<div th:replace="common/header.html :: header" class="header"></div>

<div th:replace="common/sidebar.html :: sidebar" class="sidebar"></div>

<!-- Main content -->
<main id="main" class="main">
    <div class="container border rounded p-4 bg-white">
        <!-- Hiển thị thông báo lỗi -->
        <div th:if="${error}" class="alert alert-danger" role="alert">
            <p th:text="${error}"></p>
        </div>
        <form th:action="@{/bill/edit/{id}(id=${bill.billId})}" method="post">
            <div class="row">
                <!-- Left panel - Invoice Information -->
                <div class="col-md-4 col-sm-12 p-3 left-panel border rounded bg-primary-light">
                    <h2 class="mb-4 text-primary">Thông tin hóa đơn</h2>
                    <div class="invoice-details mb-3">
                        <p><strong>Mã hóa đơn:</strong> <span th:text="${bill.code}"></span></p>
                        <input type="hidden" name="code" th:value="${bill.code}" />
                        <p><strong>Thời gian tạo:</strong> <span th:text="${formattedDate}"></span></p>
                        <input type="hidden" name="currentDateTime" th:value="${bill.createdAt}" />
                        <p><strong>Nhân viên: </strong><span th:text="${bill.employeeName}"></span></p>
                        <input type="hidden" name="employeeName" th:value="${bill.employeeName}" />
                        <p><strong>Tên sân: </strong><span th:text="${bill.courtName}"></span></p>
                        <input type="hidden" name="courtName" th:value="${bill.courtName}" />
                    </div>
                </div>

                <!-- Chọn dịch vụ -->
                <div class="col-md-8 col-sm-12 p-3 right-panel border rounded bg-secondary-light">
                    <h2 class="mb-4 text-secondary">Danh sách dịch vụ</h2>
                    <table class="table table-striped" id="services-table">
                        <thead class="bg-primary-light">
                            <tr class="text-center">
                                <th class="col-3">Tên dịch vụ</th>
                                <th class="col-2">Số lượng</th>
                                <th class="col-2">Đơn giá(VND)</th>
                                <th class="col-3">Thành tiền(VND)</th>
                                <th class="col-2">Hành động</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="detail : ${billDetails}">
                                <td>
                                    <select class="form-control service-select" name="serviceId" onchange="updatePrice(this)">
                                        <option value="">Chọn dịch vụ</option>
                                        <option th:each="service : ${services}" 
                                                th:value="${service.serviceId}" 
                                                th:data-price="${service.price}" 
                                                th:text="${service.serviceName}" 
                                                th:selected="${service.serviceId == detail.service.serviceId}">
                                        </option>
                                    </select>
                                </td>
                                <td class="text-center">
                                    <input type="number" value="0" min="0" class="form-control quantity" name="quantity" 
                                           th:value="${detail.quantity}" onchange="calculateTotal(this)">
                                </td>
                                <td class="text-center">
                                    <input type="number" value="0" min="0" class="form-control price" readonly name="price" 
                                           th:value="${detail.unitprice}" onchange="calculateTotal(this)">
                                </td>
                                <td class="text-center">
                                    <span class="total-price" th:text="${detail.quantity * detail.unitprice}">0</span>
                                </td>
                                <td class="text-center">
                                    <button class="btn btn-danger" onclick="deleteService(this)">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                    <input type="hidden" id="deleteServices" name="deleteServices" value="" />
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <button class="btn btn-primary btn-sm mb-3" onclick="addService()" type="button">Thêm dịch vụ</button>
                    <hr>
                    <p class="total text-end">Tổng tiền: <strong id="totalAmountDisplay" th:text="${bill.totalAmount}">0 VND</strong></p>
                    <input type="hidden" id="totalAmount" name="totalAmount" th:value="${bill.totalAmount}" />
                    <div class="d-flex justify-content-between">
                        <button type="submit" class="btn btn-success">Cập nhật hóa đơn</button>
                        <div>
                            <a href="/bill/list" class="btn btn-danger me-3">Hủy hóa đơn</a>
                            <button class="btn btn-primary" type="button">Xác nhận thanh toán</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</main>

<div th:replace="common/footer.html :: footer" class="footer"></div>

<a href="#" class="back-to-top d-flex align-items-center justify-content-center">
    <i class="bi bi-arrow-up-short"></i>
</a>

<!-- Vendor JS Files -->
<script src="/assets/vendor/apexcharts/apexcharts.min.js"></script>
<script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/assets/vendor/chart.js/chart.min.js"></script>
<script src="/assets/vendor/echarts/echarts.min.js"></script>
<script src="/assets/vendor/quill/quill.min.js"></script>
<script src="/assets/vendor/simple-datatables/simple-datatables.js"></script>
<script src="/assets/vendor/tinymce/tinymce.min.js"></script>
<script src="/assets/vendor/php-email-form/validate.js"></script>

<!-- Template Main JS File -->
<script src="/assets/js/main.js"></script>
</body>
</html>
